{"version":3,"sources":["frontend.products.js","jquery.twbsPagination.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"products.js","sourcesContent":["var pageSize = 9;\nvar query    = '';\nvar url      = '';\nvar format   = $('.format').text();\nvar menuId   = null;\n\n$('.change-format').click(function(event){\n    if (format == 'cards') {\n        format = 'list';\n        $('#format-list').addClass('hidden');\n        $('#format-cards').removeClass('hidden');\n    } else {\n        format = 'cards';\n        $('#format-list').removeClass('hidden');\n        $('#format-cards').addClass('hidden');\n    }\n\n    if (query == '') {\n        url = 'format=' + format;\n    } else {\n        url += '&format=' + format;\n    }\n\n    $.get('/catalog/get-products?' + query + url, function(response){\n        viewProducts(response);\n        changeUrl(format, '/catalog/products?' + query + url);\n    });\n});\n\n$('.products').addClass('active');\n\n$('#filter-city').change(function(event){\n    var id = $(this).val();\n    var city = $('#filter-city > option[value=\"' + id + '\"]').data('city');\n\n    changeLocation('city', city);\n\n    location.reload();\n});\n\n$.get('/catalog/get-catalog', function(response){\n    if (response.status == 'ok') {\n        $('#catalog-content').empty();\n        var selected = $('.menu-selected').data('id');\n        var template = $('#product-menu-template').html();\n        Mustache.parse(template);\n\n        $.each(response.data, function(key, item){\n            if (item.parent > 0) {\n                $('#' + item.parent + ' > ul').append(Mustache.render(template, item));\n                $('#' + item.parent + ' > ul').css('display', 'none');\n                $('#' + item.parent + ' > i').addClass('fa fa-angle-right');\n            } else {\n                $('#catalog-content').append(Mustache.render(template, item));\n            }\n        });\n\n        if (selected) {\n            $('#' + selected + ' span').addClass('active');\n            $.each($('#' + selected).parents('li'), function(key, val){\n                $(val).children('ul').slideDown(200);\n                $(val).children('i').addClass('fa-angle-down').removeClass('fa-angle-right');\n            });\n        }\n    } else {\n        $('#catalog-content').empty();\n        $('#catalog-content').text(response.message);\n    }\n});\n\n$('#catalog-content').on('click', 'span',function(event){\n    if ($(this).siblings('ul').children().is('li')) {\n        if ($(this).siblings('ul').css('display') == 'none') {\n            $(this).siblings('ul').slideDown(200);\n            $(this).siblings('i').addClass('fa-angle-down').removeClass('fa-angle-right');\n        } else {\n            $(this).siblings('ul').slideUp(200);\n            $(this).siblings('i').removeClass('fa-angle-down').addClass('fa-angle-right');\n        }\n    } else {\n        var id   = $(this).closest('li').attr('id');\n        var slug = $(this).closest('li').data('slug');\n        var cityId = $('#filter-city').val();\n        var cityName = $('#filter-city > option[value=\"' + cityId + '\"]').data('city');\n\n        $('.text-black-h3').removeClass('active');\n        $(this).addClass('active');\n\n        url   = '/catalog/products/' + slug + '/' + id + '?city=' + cityName;\n        query = 'menu=' + id + '&city=' + cityId;\n\n        $.get('/catalog/get-products?' + query, function(response){\n            $('#pagination').twbsPagination('destroy');\n            viewProducts(response, id);\n            changeUrl(id, url);\n\n            $(\".articles\").addClass(\"hidden\");\n        });\n    }\n});\n\n$(\"#product-name\").on('change keyup', function(event){\n    if(event.keyCode == 13) {\n        searchProducts();\n    }\n});\n\nfunction searchProducts()\n{\n    var id   = $(\"#product-city\").val();\n    var name = $(\"#product-name\").val();\n\n    if ((name != undefined) && (name != '')) {\n        query = 'name=' + name;\n        if ((id != undefined) && (id != '')) {\n            query += '&id=' + id;\n        }\n\n        $.get('/catalog/get-products?' + query, function(response){\n            viewProducts(response, id);\n        });\n    }\n\n    return true;\n}\n\nfunction viewProducts(response, id) {\n    if (response.status == 'ok') {\n        $('.products-cards').find('.card').remove();\n\n        if (format == 'cards') {\n            var template = $('#product-card-template').html();\n        } else if (format == 'list') {\n            var template = $('#product-list-template').html();\n        }\n\n        Mustache.parse(template);\n\n        $.each(response.data, function(key, item){\n            var keys = Object.keys(item.prices)[0];\n            item.price = item.prices[keys].price;\n            item.price_type = item.prices[keys].type;\n\n            $('.products-cards').append(Mustache.render(template, item));\n        });\n\n        if (response.count <= pageSize) {\n            $('#pagination').twbsPagination('destroy');\n        } else {\n            $('.default-pagination').addClass('hidden');\n            initPagination(response.count);\n        }\n    } else {\n        $('#pagination').twbsPagination('destroy');\n        $('.products-cards').find('.card').remove();\n        $('.products-cards').append('<div class=\"col-md-12 col-sm-12 col-xs-12 card text-center font-up text-black-h2\">' + response.message + '</div>');\n        $('#pagination').twbsPagination('destroy');\n    }\n\n    $('.articles').addClass('hidden');\n}\n\nfunction changeUrl(title, url) {\n    if (typeof (history.pushState) != \"undefined\") {\n        var obj = { Title: title, Url: url };\n        history.pushState(obj, obj.Title, obj.Url);\n    } else {\n        alert(\"Browser does not support HTML5.\");\n    }\n}\n\nfunction changeLocation(partLinck, data) {\n    var get = location.search;\n    var url = '?';\n    var flag = false;\n\n    if (get) {\n        get = get.substr(1).split('&');\n\n        $.each(get, function(key, val){\n            if ( (val != '') && (val != undefined) ) {\n                part = val.split('=');\n\n                if ((part[0] != '') && (part[1] != '')) {\n                    if (part[0] == partLinck) {\n                        part[1] = data;\n                        flag = true;\n                    }\n                    url += part[0] + '=' + part[1] + '&';\n                }\n            }\n        });\n\n        if (flag) {\n            url = url.slice(0, -1);\n        } else {\n            url += partLinck + '=' + data;\n        }\n    } else {\n        url += partLinck + '=' + data;\n    }\n\n    window.history.replaceState('', '', url);\n}\n\nfunction initPagination(count)\n{\n    pages = Math.ceil(count/pageSize);\n\n    $('#pagination').twbsPagination({\n        totalPages: pages,\n        visiblePages: 9,\n        first: false,\n        prev: '«',\n        next: '»',\n        last: false,\n        onPageClick: function (event, page) {\n            $.get('/catalog/get-products?' + query + '&page=' + page, function(response){\n                viewProducts(response);\n                changeLocation('page', page)\n            });\n        }\n    });\n}\n\n$('body').on('click', '.add-cart', function(event){\n    var tut = this;\n    var id = $(this).data('id');\n\n    $.post('/products/product-to-cart', {id: id}, function(response){\n        if (response.status == 'ok') {\n            if (response.data > 0) {\n                $('.shopping-cart-badge').removeClass('hidden');\n                $('.shopping-cart-badge').text(response.data);\n\n                $(tut).addClass('btn-default').removeClass('btn-success');\n                $(tut).text(response.button);\n            } else {\n                $('.shopping-cart-badge').addClass('hidden');\n                $('.shopping-cart-badge').text('');\n            }\n\n            if (response.message != '') {\n                var message = '<span class=\"text-gray-16\">' + response.message + '</span>';\n                $('#info-modal .modal-body').html(message);\n                $('#info-modal').modal('show');\n            }\n        } else if ((response.status == 'bad') && (response.error == 'auth')) {\n            if (!$('#login-form-send #email').closest('.form-group').hasClass('has-error')) {\n                var message = '<span class=\"help-block\"><strong>' + response.message + '</strong></span>';\n                $('#login-form-send #email').closest('.form-group').addClass('has-error');\n                $('#login-form-send #email').closest('.form-group').append(message);\n            }\n\n            $('#login-form').modal('show');\n        }\n    });\n});","/*!\n * jQuery pagination plugin v1.4\n * http://esimakin.github.io/twbs-pagination/\n *\n * Copyright 2014-2015, Eugene Simakin\n * Released under Apache 2.0 license\n * http://apache.org/licenses/LICENSE-2.0.html\n */\n(function ($, window, document, undefined) {\n\n    'use strict';\n\n    var old = $.fn.twbsPagination;\n\n    // PROTOTYPE AND CONSTRUCTOR\n\n    var TwbsPagination = function (element, options) {\n        this.$element = $(element);\n        this.options = $.extend({}, $.fn.twbsPagination.defaults, options);\n\n        if (this.options.startPage < 1 || this.options.startPage > this.options.totalPages) {\n            throw new Error('Start page option is incorrect');\n        }\n\n        this.options.totalPages = parseInt(this.options.totalPages);\n        if (isNaN(this.options.totalPages)) {\n            throw new Error('Total pages option is not correct!');\n        }\n\n        this.options.visiblePages = parseInt(this.options.visiblePages);\n        if (isNaN(this.options.visiblePages)) {\n            throw new Error('Visible pages option is not correct!');\n        }\n\n        if (this.options.totalPages < this.options.visiblePages) {\n            this.options.visiblePages = this.options.totalPages;\n        }\n\n        if (this.options.onPageClick instanceof Function) {\n            this.$element.first().on('page', this.options.onPageClick);\n        }\n\n        if (this.options.href) {\n            var match, regexp = this.options.href.replace(/[-\\/\\\\^$*+?.|[\\]]/g, '\\\\$&');\n            regexp = regexp.replace(this.options.pageVariable, '(\\\\d+)');\n            if ((match = new RegExp(regexp, 'i').exec(window.location.href)) != null) {\n                this.options.startPage = parseInt(match[1], 10);\n            }\n        }\n\n        var tagName = (typeof this.$element.prop === 'function') ?\n            this.$element.prop('tagName') : this.$element.attr('tagName');\n\n        if (tagName === 'UL') {\n            this.$listContainer = this.$element;\n        } else {\n            this.$listContainer = $('<ul></ul>');\n        }\n\n        this.$listContainer.addClass(this.options.paginationClass);\n\n        if (tagName !== 'UL') {\n            this.$element.append(this.$listContainer);\n        }\n\n        if (this.options.initiateStartPageClick) {\n            this.show(this.options.startPage);\n        } else {\n            this.render(this.getPages(this.options.startPage));\n            this.setupEvents();\n        }\n\n        return this;\n    };\n\n    TwbsPagination.prototype = {\n\n        constructor: TwbsPagination,\n\n        destroy: function () {\n            this.$element.empty();\n            this.$element.removeData('twbs-pagination');\n            this.$element.off('page');\n\n            return this;\n        },\n\n        show: function (page) {\n            if (page < 1 || page > this.options.totalPages) {\n                throw new Error('Page is incorrect.');\n            }\n\n            this.render(this.getPages(page));\n            this.setupEvents();\n\n            this.$element.trigger('page', page);\n\n            return this;\n        },\n\n        buildListItems: function (pages) {\n            var listItems = [];\n\n            // Add \"first\" page button\n            if (this.options.first) {\n                listItems.push(this.buildItem('first', 1));\n            }\n            // Add \"previous\" page button\n            if (this.options.prev) {\n                var prev = pages.currentPage > 1 ? pages.currentPage - 1 : this.options.loop ? this.options.totalPages  : 1;\n                listItems.push(this.buildItem('prev', prev));\n            }\n            // Add \"pages\"\n            for (var i = 0; i < pages.numeric.length; i++) {\n                listItems.push(this.buildItem('page', pages.numeric[i]));\n            }\n            // Add \"next\" page button\n            if (this.options.next) {\n                var next = pages.currentPage < this.options.totalPages ? pages.currentPage + 1 : this.options.loop ? 1 : this.options.totalPages;\n                listItems.push(this.buildItem('next', next));\n            }\n            // Add \"last\" page button\n            if (this.options.last) {\n                listItems.push(this.buildItem('last', this.options.totalPages));\n            }\n\n            return listItems;\n        },\n\n        buildItem: function (type, page) {\n            var $itemContainer = $('<li></li>'),\n                $itemContent = $('<a></a>'),\n                itemText = null;\n\n            itemText = this.options[type] ? this.makeText(this.options[type], page) : page;\n            $itemContainer.addClass(this.options[type + 'Class']);\n            $itemContainer.data('page', page);\n            $itemContainer.data('page-type', type);\n            $itemContainer.append($itemContent.attr('href', this.makeHref(page)).addClass(this.options.anchorClass).html(itemText));\n\n            return $itemContainer;\n        },\n\n        getPages: function (currentPage) {\n            var pages = [];\n\n            var half = Math.floor(this.options.visiblePages / 2);\n            var start = currentPage - half + 1 - this.options.visiblePages % 2;\n            var end = currentPage + half;\n\n            // handle boundary case\n            if (start <= 0) {\n                start = 1;\n                end = this.options.visiblePages;\n            }\n            if (end > this.options.totalPages) {\n                start = this.options.totalPages - this.options.visiblePages + 1;\n                end = this.options.totalPages;\n            }\n\n            var itPage = start;\n            while (itPage <= end) {\n                pages.push(itPage);\n                itPage++;\n            }\n\n            return {\"currentPage\": currentPage, \"numeric\": pages};\n        },\n\n        render: function (pages) {\n            var _this = this;\n            this.$listContainer.children().remove();\n            var items = this.buildListItems(pages);\n            jQuery.each(items, function(key, item){\n                _this.$listContainer.append(item);\n            });\n\n            this.$listContainer.children().each(function () {\n                var $this = $(this),\n                    pageType = $this.data('page-type');\n\n                switch (pageType) {\n                    case 'page':\n                        if ($this.data('page') === pages.currentPage) {\n                            $this.addClass(_this.options.activeClass);\n                        }\n                        break;\n                    case 'first':\n                            $this.toggleClass(_this.options.disabledClass, pages.currentPage === 1);\n                        break;\n                    case 'last':\n                            $this.toggleClass(_this.options.disabledClass, pages.currentPage === _this.options.totalPages);\n                        break;\n                    case 'prev':\n                            $this.toggleClass(_this.options.disabledClass, !_this.options.loop && pages.currentPage === 1);\n                        break;\n                    case 'next':\n                            $this.toggleClass(_this.options.disabledClass,\n                                !_this.options.loop && pages.currentPage === _this.options.totalPages);\n                        break;\n                    default:\n                        break;\n                }\n\n            });\n        },\n\n        setupEvents: function () {\n            var _this = this;\n            this.$listContainer.find('li').each(function () {\n                var $this = $(this);\n                $this.off();\n                if ($this.hasClass(_this.options.disabledClass) || $this.hasClass(_this.options.activeClass)) {\n                    $this.on('click', false);\n                    return;\n                }\n                $this.click(function (evt) {\n                    // Prevent click event if href is not set.\n                    !_this.options.href && evt.preventDefault();\n                    _this.show(parseInt($this.data('page')));\n                });\n            });\n        },\n\n        makeHref: function (page) {\n            return this.options.href ? this.makeText(this.options.href, page) : \"#\";\n        },\n\n        makeText: function (text, page) {\n            return text.replace(this.options.pageVariable, page)\n                .replace(this.options.totalPagesVariable, this.options.totalPages)\n        }\n\n    };\n\n    // PLUGIN DEFINITION\n\n    $.fn.twbsPagination = function (option) {\n        var args = Array.prototype.slice.call(arguments, 1);\n        var methodReturn;\n\n        var $this = $(this);\n        var data = $this.data('twbs-pagination');\n        var options = typeof option === 'object' ? option : {};\n\n        if (!data) $this.data('twbs-pagination', (data = new TwbsPagination(this, options) ));\n        if (typeof option === 'string') methodReturn = data[ option ].apply(data, args);\n\n        return ( methodReturn === undefined ) ? $this : methodReturn;\n    };\n\n    $.fn.twbsPagination.defaults = {\n        totalPages: 1,\n        startPage: 1,\n        visiblePages: 5,\n        initiateStartPageClick: true,\n        href: false,\n        pageVariable: '{{page}}',\n        totalPagesVariable: '{{total_pages}}',\n        page: null,\n        first: 'First',\n        prev: 'Previous',\n        next: 'Next',\n        last: 'Last',\n        loop: false,\n        onPageClick: null,\n        paginationClass: 'pagination',\n        nextClass: 'next',\n        prevClass: 'prev',\n        lastClass: 'last',\n        firstClass: 'first',\n        pageClass: 'page',\n        activeClass: 'active',\n        disabledClass: 'disabled',\n        anchorClass: 'page-link'\n    };\n\n    $.fn.twbsPagination.Constructor = TwbsPagination;\n\n    $.fn.twbsPagination.noConflict = function () {\n        $.fn.twbsPagination = old;\n        return this;\n    };\n\n})(window.jQuery, window, document);\n"],"sourceRoot":"/source/"}