{"version":3,"sources":["admin.menu.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"menu.js","sourcesContent":["$(document).ready(function(){\n\n    $(\".lang\").click(function(event){\n        $(\".check-language\").data(\"lang\", $(this).data(\"lang\"));\n        $(\".current-language\").html($(this).html());\n\n        loadMenu();\n    });\n\n    function loadMenu()\n    {\n        $.get('/administration/menu/' + $(\".check-language\").data(\"lang\"), function(response){\n            if (response.status == 'ok') {\n\n                $('#tree').empty();\n                var template = $('#menu-template').html();\n                Mustache.parse(template);\n\n                $.each(response.data, function(key, item){\n                    if (item.parent > 0) {\n                        $('#' + item.parent + ' > ol').append(Mustache.render(template, item));\n                        $('#' + item.parent + ' > ol').css('display', 'none');\n                        $('#' + item.parent + ' > i').removeClass('fake-width').addClass('fa fa-angle-right pull-left');\n                    } else {\n                        $('#tree').append(Mustache.render(template, item));\n                    }\n                });\n\n                $(\".root ol\").sortable({\n                    cursor: 'pointer',          // внешний вид курсора\n                    connectWith: 'ol',          // наборы из которых можно перетаскивать элементы\n                    dropOnEmpty: true,          // разрешаем перетаскивать эле-ты в пустые списки\n                    delay: 500,                 // задержка перед началом перетаскивания\n                    placeholder: 'placeholder', // класс вакантного места\n                    start: function(event, ui) {\n                        ui.item.children('ol').addClass('hidden');\n                    },\n                    stop: function(event, ui) {\n                        // записываем ID родителя в которого был перемещена ветвь\n                        var parent = ui.item.parent().closest(\"li\").attr('id');\n\n                        if ((!parent) && (ui.item.closest(\"ol\").attr('id') == 'tree')) {\n                            parent = 0;\n                        }\n\n                        ui.item.attr('parent', parent);\n                        ui.item.children('ol').removeClass('hidden');\n\n                        // перерасчиет веса ветвей\n                        var id     = [],\n                            weight = [],\n                            parent = [];\n\n                        $(\".root li\").each(function(index) {\n                            $(this).attr('sort', index + 1);\n\n                            id.push($(this).attr('id'));\n                            weight.push($(this).attr('sort'));\n                            parent.push($(this).attr('parent'));\n                        });\n\n                        $.ajax('/administration/menu-sort', {\n                            data: {id: id, weight: weight, parent: parent},\n                            type: \"POST\",\n                            beforeSend: function(xhr) {\n                                xhr.setRequestHeader (\"X-CSRF-TOKEN\", $(\"[name='_token']\").val());\n                            },\n                            error: function(xhr) {\n                                // console.log(xhr.statusText);\n                            },\n                            success: function(response) {\n                                loadMenu();\n                            },\n                        });\n                    }\n                });\n            }\n        }, \"JSON\");\n\n    };\n\n    loadMenu();\n\n    $(\"#tree\").on('click', 'span',function(event){\n        if ($(this).siblings('ol').children().is('li')) {\n            if ($(this).siblings('ol').css('display') == 'none') {\n                $(this).siblings('ol').slideDown();\n                $(this).siblings('i').addClass(\"fa-angle-down\").removeClass(\"fa-angle-right\");\n            } else {\n                $(this).siblings('ol').slideUp();\n                $(this).siblings('i').removeClass(\"fa-angle-down\").addClass(\"fa-angle-right\");\n            }\n        }\n    });\n\n    $(\"#tree\").on('click', '.btn-edit', function(event){\n        $.get('/administration/menu-item/' + $(this).data('id'), function(response){\n            if (response.status == 'ok') {\n                var name = JSON.parse(response.data.name);\n\n                $(\"#slug\").val(response.data.slug);\n                $(\"#menu-en\").val(name.en);\n                $(\"#menu-ru\").val(name.ru);\n                $(\"#menu-uk\").val(name.uk);\n                $(\"#menu-id\").val(response.data.id);\n            }\n        }, \"json\");\n    });\n\n    $(\"#tree\").on('click', '.btn-delete', function(event){\n        $(\"#menu-item-id\").val($(this).data('id'));\n        $(\".delete-name-item\").html($(this).data('name'));\n    });\n});"],"sourceRoot":"/source/"}